<?php

function brainjogging_wordlist_form_alter(&$form, &$form_state, $form_id) {
 
   global $user;
   if( $form_id == "word_list_node_form" || $form_id == "word_list_category_node_form" ){
    unset($form['body_field']['format']);
    unset($form['revision_information']);
    $form['options']['#collapsible'] = FALSE;
    $form['name'] = array('#type' => 'value', '#value' => $user->name);
    unset($form['author']);
    unset($form['options']['promote'],$form['options']['sticky']);
    }
   if( $form_id == "word_list_node_form"){
    // Remove and alter fields
   
    // Add category filed
    $form['category_id'] = array(
      '#type' => 'select', 
      '#title' => t('Category'), 
      '#default_value' => brainjogging_wordlist_get_wl_category($form['nid']['#value']),
      '#required' => TRUE,
      '#options' => brainjogging_wordlist_get_wl_categories(),
      '#description' => t('select the category for this world list'),
    );
  }
  if( $form_id == "word_list_category_node_form"){
    
    $form['options']=array('#type' => 'value', '#value' => $form['options']['status']['#default_value'] = 1);

    
  }
  
  
  
}

function brainjogging_wordlist_get_wl_categories(){
 $res = db_query("SELECT nid,title FROM {node} WHERE type = 'word_list_category' ORDER BY title");
 while($obj = db_fetch_object($res)){
  $categories[$obj->nid] = $obj->title;
 }
 return $categories;
}

function brainjogging_wordlist_get_wl_category($nid){
  if($nid){
    return db_result(db_query("SELECT c_id FROM {bj_wordlist_relativity} WHERE wl_id = %d",$nid));    
  }
}

function brainjogging_wordlist_nodeapi(&$node, $op, $a3 = NULL, $a4 = NULL) {
  if($node->type == 'word_list'){
  switch ($op) {
    case 'insert':
      db_query("INSERT INTO {bj_wordlist_relativity} (c_id,wl_id) VALUES(%d, %d)",$node->category_id, $node->nid);
      break;
    case 'update':
      db_query("UPDATE {bj_wordlist_relativity} SET c_id = %d WHERE  wl_id = %d",$node->category_id, $node->nid);
      break;
    case 'load':
      $node->category_id = brainjogging_wordlist_get_wl_category($node->nid);
      break;
    case 'delete';
      db_query("DELETE FROM {bj_wordlist_relativity} WHERE wl_id =%d", $node->nid);
      break;
  }  
  }  
}


?>